{% extends "base.html" %}
{% block content %}
<div class="max-w-4xl mx-auto bg-white shadow-md rounded-lg p-6 p-6 mt-10">

    {% if user.is_authenticated %}
    <p class="text-gray-700 text-lg mb-4 font-semibold">
        Logged in as <span class="font-semibold text-green-600 ">@{{ user.username }}</span>
    </p>
    {% endif %}

    <h2 class="text-3xl font-semibold mb-6 text-center text-gray-800">Your Short URLs</h2>

    <!-- Create Short URL Form -->
    <form method="post" class="flex flex-col sm:flex-row items-center justify-between gap-3 mb-6">
        {% csrf_token %}
        <div class="flex-1 w-full">
            <input type="url" name="original_url" placeholder="https://example.com/very-long-link" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500
                placeholder-gray-400 text-gray-700" />
        </div>
        <button type="submit" class="bg-blue-600 text-white px-5 py-2 rounded hover:bg:blue-700 transition">
            Create Short URL
        </button>
    </form>

    <!-- URLs List -->
    <ul class="divide-y divide-gray-200">
        {% for url in urls %}
        <li class="py-4 flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div class="space-y-1">
                <strong>
                    <a href="{{ base_url }}/{{ url.short_code }}" target="_blank"
                        class="text-blue-600 hover:underline text-lg">
                        {{ base_url }}/{{ url.short_code }}
                    </a>
                </strong>
                <div>
                    <a href="{{ url.original_url }}" target="_blank"
                        class="text-gray-600 hover:text-gray-800 break-all">
                        {{ url.original_url }}
                    </a>
                </div>
                <span class="text-sm text-gray-500">Clicks: {{ url.click_count }}</span>
                <span class="text-sm text-gray-500">Created at: {{ url.created_at }}</span>
            </div>

            <!-- Actions -->
            <div class="mt-3 sm:mt-0 flex items-center gap-3">
                <button type="button" onclick="copyToClipboard('{{ base_url }}/{{ url.short_code }}')"
                    class="text-sm bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition">
                    Copy
                </button>
                <form method="post" action="{% url 'shortener:delete' url.pk %}">
                    {% csrf_token %}
                    <button type="submit"
                        class="text-sm bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 transition">
                        Delete
                    </button>
                </form>
            </div>
        </li>
        {% empty %}
        <li class="py-4 text-center text-gray-500">
            No short URLs yet.
        </li>
        {% endfor %}
    </ul>
</div>

<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            alert("Copied to clipboard: " + text);
        }).catch(err => {
            alert("Failed to copy: " + err);
        })
    }
</script>
{% endblock %}